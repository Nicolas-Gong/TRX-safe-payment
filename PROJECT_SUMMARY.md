# TRX Safe Payment - 项目总结报告

## 项目概述
TRX Safe Payment 是一款专为 TRON 网络设计的安全支付与转账应用，特别针对“卖能量”等高频、高安全要求的业务场景进行了底层约束与安全加固。应用通过热钱包直接转账与冷热钱包隔离扫码签名两种模式，实现了极致的资产安全性。

## 核心安全特性
1.  **分层风控体系**：
    *   **协议白名单**：硬性限制仅支持 `TransferContract` (TRX 转账)，完全屏蔽智能合约调用与自定义数据，杜绝授信陷阱。
    *   **地址白名单**：内置地址簿管理，非白名单地址转账触发增强风险提示。
    *   **金额动态校验**：强制校验交易金额必须等于 `单价 × 倍率`，防止篡改金额。
2.  **极致隐私保护**：
    *   **私钥不出库**：私钥仅在安全存储（EncryptedSharedPreferences）与内存 KeyPair 中存在，禁止导出。
    *   **查看私钥保护**：查看私钥需通过高强度生物识别（指纹/面容）二次认证。
    *   **无数据上报**：除必要的节点通信外，不收集任何用户信息。
3.  **App 级安全锁**：
    *   **全局锁定机制**：应用退至后台自动锁定，需生物识别解锁。
    *   **立即锁定功能**：支持一键手动锁定应用。
4.  **冷热钱包隔离**：
    *   **无网签名**：支持冷钱包模式（完全断网），通过二维码分片（QRSplitter）传输大数据量交易。
    *   **防篡改校验**：热钱包在广播冷钱包签名的交易前，会自动对照原始未签名数据，确保交易参数未被篡改。

## 已完成功能模块
1.  **钱包管理**：支持创建钱包、私钥导入、观察钱包导入，以及安全的私钥本地备份。
2.  **转账流程**：
    *   **直连转账**：快速完成小额或可信支付。
    *   **扫码流程**：提供从生成未签名码、扫码签名、到回传广播的完整闭环。
    *   **地址选择**：转账界面支持从地址簿快捷选择收款人。
3.  **账务系统**：
    *   **已发送记录**：本地保存所有发出的交易及其详细状态。
    *   **入账查询**：实时查询链上最近入账交易，补齐业务确认环节。
    *   **状态轮询**：自动监控 PENDING 交易状态，确保 UI 及时更新。
4.  **配置与设置**：
    *   **多节点支持**：内置主流公共节点，支持自定义 grpc 地址。
    *   **批量参数**：单价与倍率配置，支持单价锁定功能。

## 技术架构
*   **核心库**：`org.tron.trident` (TRON 官方 SDK)
*   **存储**：`Jetpack Room` (地址簿), `EncryptedSharedPreferences` (私钥), `SharedPrefs` (配置与记录)
*   **UI**：`Material Design 3`, `ViewBinding`, `Coroutine`, `LifecycleScope`
*   **通信**：`gRPC` 协议直连 TRON 节点

## 总结
本项目已实现 100% 的核心业务逻辑闭环，通过严苛的底层代码约束（如 `TransactionValidator` 与 `WalletManager` 的静态类型检查）彻底消除了目前市面上钱包常见的被非法合约“盗领”的风险，是一款真正意义上的安全工具。
